<!-- new-hall.html -->
<div class="add-hall-form">
  <header>
    <h1>Ajouter une salle</h1>
  </header>

  <form [formGroup]="hallForm" (ngSubmit)="onSubmit()" autocomplete="off">
    <!-- Theater -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Choisir un cinéma</mat-label>
      <mat-select
        formControlName="theaterId"
        required
        (focus)="clearMessages()"
        (selectionChange)="clearMessages()"
      >
        <mat-option [value]="''">Sélectionner...</mat-option>
        @for (theater of theaters(); track theater.theaterId) {
        <mat-option [value]="theater.theaterId">
          {{ theater.theaterId }} — {{ theater.city }}
        </mat-option>
        }
      </mat-select>
      @if (hallForm.get('theaterId')?.invalid &&
      (hallForm.get('theaterId')?.dirty || hallForm.get('theaterId')?.touched))
      {
      <mat-error>Le cinéma est requis</mat-error>
      }
    </mat-form-field>

    <!-- Hall ID -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Identifiant de la salle</mat-label>
      <input
        matInput
        placeholder="hallA"
        formControlName="hallId"
        required
        autocomplete="off"
        (focus)="clearMessages()"
        (input)="clearMessages()"
      />
      @if (hallForm.get('hallId')?.invalid && (hallForm.get('hallId')?.dirty ||
      hallForm.get('hallId')?.touched)) {
      <mat-error>L'identifiant de la salle est requis</mat-error>
      }
    </mat-form-field>

    <!-- Quality -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Qualité de la salle</mat-label>
      <mat-select
        formControlName="quality"
        required
        (focus)="clearMessages()"
        (selectionChange)="clearMessages()"
      >
        <mat-option value="2D">2D</mat-option>
        <mat-option value="3D">3D</mat-option>
        <mat-option value="IMAX">IMAX</mat-option>
        <mat-option value="4DX">4DX</mat-option>
      </mat-select>
      @if (hallForm.get('quality')?.invalid && (hallForm.get('quality')?.dirty
      || hallForm.get('quality')?.touched)) {
      <mat-error>La qualité est requise</mat-error>
      }
    </mat-form-field>

    <!-- Rows -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nombre de rangées</mat-label>
      <input
        matInput
        type="number"
        min="1"
        placeholder="5"
        formControlName="rows"
        required
        autocomplete="off"
        (change)="onDimsChange()"
        (blur)="onDimsChange()"
        (keyup.enter)="onDimsChange()"
        (focus)="clearMessages()"
      />
      @if (hallForm.get('rows')?.invalid && (hallForm.get('rows')?.dirty ||
      hallForm.get('rows')?.touched)) {
      <mat-error>Le nombre de rangées doit être supérieur à 0</mat-error>
      }
    </mat-form-field>

    <!-- Columns -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nombre de sièges par rangée</mat-label>
      <input
        matInput
        type="number"
        min="1"
        placeholder="10"
        formControlName="columns"
        required
        autocomplete="off"
        (change)="onDimsChange()"
        (blur)="onDimsChange()"
        (keyup.enter)="onDimsChange()"
        (focus)="clearMessages()"
      />
      @if (hallForm.get('columns')?.invalid && (hallForm.get('columns')?.dirty
      || hallForm.get('columns')?.touched)) {
      <mat-error>Le nombre de sièges doit être supérieur à 0</mat-error>
      }
    </mat-form-field>

    <!-- Seat grid -->
    @if (seatsGrid.length > 0) {
    <div class="seat-grid">
      <h3>Configuration des sièges</h3>
      <p class="grid-instructions">
        Personnalisez les identifiants des sièges :
      </p>

      <table>
        @for (row of seatsGrid; track $index; let i = $index) {
        <tr>
          @for (seat of row; track $index; let j = $index) {
          <td>
            <input
              type="text"
              [value]="seat"
              (input)="onSeatInputChange($event, i, j)"
              class="seat-input"
              maxlength="8"
              [placeholder]="'Siège ' + seat"
            />
          </td>
          }
        </tr>
        }
      </table>
    </div>
    }

    <button
      mat-raised-button
      color="primary"
      class="full-width"
      type="submit"
      [disabled]="hallForm.invalid || isLoading()"
    >
      @if (isLoading()) {
      <ng-container>
        <mat-icon>hourglass_empty</mat-icon>
        Création en cours...
      </ng-container>
      } @else {
      <ng-container>
        <mat-icon>add</mat-icon>
        Ajouter la salle
      </ng-container>
      }
    </button>

    @if (successMessage()) {
    <div class="success-message">
      <mat-icon>check_circle</mat-icon>
      <span>{{ successMessage() }}</span>
    </div>
    } @if (apiError()) {
    <div class="api-error-message">
      <mat-icon>error</mat-icon>
      <span>{{ apiError() }}</span>
    </div>
    }
  </form>
</div>
